---
title: "Practice file"
author: "Marco Sorbona"
format: html
editor: visual
echo: false
editor_options: 
  chunk_output_type: console
warning: false
message: false
engine: knitr
---

## Packages

```{r}
#| warning: false
#| message: false
library(tidyverse)
library(tidymodels)
library(scales)
library(ggthemes)
library(palmerpenguins)
```

I will use the `penguin` data set to play around with visualisations.

```{r}
glimpse(penguins)
```

## Plots

Emply plot:

```{r}
ggplot(data = penguins)
```

Visual properties using mapping as **aesthetics:**

```{r}
ggplot(
  data = penguins,
  mapping = aes(x = flipper_length_mm, y = body_mass_g)
)
```

Definition of the **geom**: the geometrical object to represent the data.

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point()
```

Adding aesthetic and layers:

Let's differentiate in base of the species using different colors. the color is the aesthetic function of ggplot2.

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
  geom_point()
```

we can add a curve over our data:

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
  geom_point() +
  geom_smooth(method = "lm")
```

we can pass our mapping at the local level instead of the global level:

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(colour = species)) +
  geom_smooth(method = "lm")
```

in this case we can see that the colored species are only represented in the scatter plot and the linear model is applied to all the data.

we can use both color AND shape to help differentiate:

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(colour = species, shape = species)) +
  geom_smooth(method = "lm")
```

Adding an extra layer: the labels with `labs()`and a layer for colorblind safe pallets:

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(colour = species, shape = species)) +
  geom_smooth(method = "lm") +
  labs(
    title = "Body mass and flipper length",
    subtitle = "Dimenisons for Adelie, Chinstrap, and Gentoo Penguins",
    x = "Flipper length (mm)",
    y = "Body mass (g)",
    color = "Species", 
    shape = "Species"
  ) +
  scale_color_colorblind()
```

## Exercises:

1.  how many rows and columns in `penguins`?
    -   rows in penguins are `r nrow(penguins)` while columns are `r ncol(penguins)`
2.  What does the `bill_depth_mm` variable in the `penguins` data frame describe? Read the help for [`?penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.html) to find out.
    -   it records the depth of the bill in millimeters
3.  Make a scatterplot of `bill_depth_mm` vs. `bill_length_mm`. That is, make a scatterplot with `bill_depth_mm` on the y-axis and `bill_length_mm` on the x-axis. Describe the relationship between these two variables.
    -   Based on the scatter-plot below, it's hard to say there is a relationship between the two variable. However, it seems the data is clustered in at least two areas.

```{r}
ggplot(
  penguins,
  aes(x = bill_length_mm, y = bill_depth_mm)
) +
  geom_point()
```

4.  What happens if you make a scatterplot of `species` vs. `bill_depth_mm`? What might be a better choice of geom?
    -   A better geom would be `geom_boxplot` : in this case we have categorical data on y-axes and continuous data on the x-axes therefore a **boxplot** is more appropriate.

```{r}
ggplot(
  penguins,
  aes(x = bill_depth_mm, y = species)
) +
  geom_boxplot()
```

5.  Why does the following give an error and how would you fix it?

    `ggplot(data = penguins) + geom_point()`

    -   it gives an error because it is lacking the mapping argument: the aesthetic parameters. the `aes()` should contain the data for the x and y axes, as follow:
    -   `ggplot(data = penguins, aes(x = xxx, y = yyy)) + geom_point()`

6.  What does the `na.rm` argument do in [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.html)? What is the default value of the argument? Create a scatterplot where you successfully use this argument set to `TRUE`.

    -   the `na.rm` argument deals with *missing values.* By default is set to FALSE and missing values are removed with a *warning.* When `na.rm` is set to TRUE *missing values* are removed without a *warning*

```{r}
ggplot(
  penguins,
  aes(x = bill_length_mm, y = bill_depth_mm)
) +
  geom_point(na.rm = TRUE)
```

7.  Add the following caption to the plot you made in the previous exercise: “Data come from the palmerpenguins package.” Hint: Take a look at the documentation for [`labs()`](https://ggplot2.tidyverse.org/reference/labs.html).

```{r}
ggplot(
  penguins,
  aes(x = bill_depth_mm, y = species)
) +
  geom_boxplot() +
  labs(
    caption = "Data come from the palmerpenguins package"
  )
```

8.  Recreate the following visualization. What aesthetic should `bill_depth_mm` be mapped to? And should it be mapped at the global level or at the geom level?
    -   it should be mapped to color. regarding whether to map it into *global* or *local*, i think it doesn't matter here? But i don't know why.

```{r}
ggplot(
  penguins,
  aes(x = flipper_length_mm, y = body_mass_g, color = bill_depth_mm)) +
  geom_point(aes(color = bill_depth_mm)) +
  geom_smooth(method = "lm")
```

9.  Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.
    -   the code below will plot a scatterplot of body mass (y) vs flipper length (x) coloring by island. the plot has another geom: a smooth curve without confidence interval (se = FALSE)

    -   i was wrong it has three linear models, one for each island

        ```         
        ggplot(   
          data = penguins,   
          mapping = aes(x = flipper_length_mm, y = body_mass_g, color = island) ) +   
          geom_point() +   
          geom_smooth(se = FALSE)
        ```

```{r}
ggplot(   
  data = penguins,   
  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = island) ) +   
  geom_point() +   
  geom_smooth(se = FALSE)
```

10. Will these two graphs look different? Why/why not?
    -   Yes they look the sam,e because the local has the same as the global

```         
ggplot(   data = penguins,   mapping = aes(x = flipper_length_mm, y = body_mass_g) ) +   geom_point() +   geom_smooth()  ggplot() +   geom_point(     data = penguins,     mapping = aes(x = flipper_length_mm, y = body_mass_g)   ) +   geom_smooth(     data = penguins,     mapping = aes(x = flipper_length_mm, y = body_mass_g)   )
```

Global aesthetic:

```{r}
#| label: Q10 - Global
ggplot(   data = penguins,   mapping = aes(x = flipper_length_mm, y = body_mass_g) ) +   geom_point() +   geom_smooth()  
```

Local aesthetic:

```{r}
#| label: Q10 - Local
ggplot() +   geom_point(     data = penguins,     mapping = aes(x = flipper_length_mm, y = body_mass_g)   ) +   geom_smooth(     data = penguins,     mapping = aes(x = flipper_length_mm, y = body_mass_g))
```

------------------------------------------------------------------------

## 1.4 Visualizing distributions

visualisation of categorical variables, such as `species`

```{r}
penguins |>
  ggplot(aes(x = species)) +
  geom_bar()
```

reorder bar plot in descending order of frequency:

```{r}
ggplot(penguins, aes(x = fct_infreq(species))) +
  geom_bar()
```

### 1.4.2 A numerical variable

An histogram for continuous variables:

```{r}
ggplot(
  penguins, 
  aes(x = body_mass_g)
) +
  geom_histogram(binwidth = 200)
```

An alternative visualisation is a *density plot:*

```{r}
ggplot(
  penguins, 
  aes(x = body_mass_g)
) +
  geom_density()
```

### 1.4.3 Exercises

1.  Make a bar plot of `species` of `penguins`, where you assign `species` to the `y` aesthetic. How is this plot different?
    -   In this case, it's a bar plot of categorical data with species on Y axes and on x axes we have the counts for each species

```{r}
ggplot(penguins, aes(y = species))+
  geom_bar()
```

We can order the bars from largest to smallest (from bottom to top!) using: `fct_infreq`

To get from Top to Bottom add: `fct_rev`

```{r}
ggplot(penguins, aes(y = fct_rev(fct_infreq(species)))) +
  geom_bar()
```

2.  How are the following two plots different? Which aesthetic, `color` or `fill`, is more useful for changing the color of bars?
    -   First plot provides colors of the outline of the bars, while the second plot fills the bars with solid color. `fill` is more useful

```{r}
ggplot(
  penguins,
  aes(x = species)
) +
  geom_bar(color = "red")
```

```{r}
ggplot(
  penguins,
  aes(x = species)
) +
  geom_bar(fill = "red")
```

3.  What does the `bins` argument in [`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.html) do?
    -   impose the number of bins and overrides the `binwidth`
4.  Make a histogram of the `carat` variable in the `diamonds` dataset that is available when you load the tidyverse package. Experiment with different binwidths. What binwidth reveals the most interesting patterns?
    -   the best `binwidth` is 0.01. it shows interesting patterns: it's a multimodal distribution

```{r}
ggplot(
  diamonds,
  aes(x = carat)
) +
  geom_histogram(binwidth = 0.01)
```

## 1.5 Visualizing relationships

Visualisation of two or more variables and related geoms

### 1.5.1. a *numerical* and *categorical* variable: **boxplot**

```{r}
ggplot(penguins, aes(x = species, y = body_mass_g)) +
  geom_boxplot()
```

we can also make **density** plots:

```{r}
ggplot(penguins, aes(x = body_mass_g, color = species)) +
  geom_density(linewidth = 0.75)
```

```{r}
ggplot(penguins, aes(x = body_mass_g, color = species, fill = species)) +
  geom_density(alpha = 0.5, linewidth = 0.75)
```

### 1.5.2. Two categorical variables

we can use **stacked bar plots** for relationships between two categorical variables. For example: species and islands (which species in each island)

```{r}
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar()
```

to show percentage:

```{r}
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(position = "fill")
```

Change labels with `labs()`

```{r}
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(position = "fill") +
  labs(y = "Proportion", x = "Island")
```

### 1.5.3. two numerical variables

scatterplots are the most common visualisation:

```{r}
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point()
```

### 1.5.4. three or more variables

more variables by **mapping** them to additional *aesthetics*. color for species and shape for islands:

```{r}
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species, shape = island))
```

but it can become quite cluttered. so we can add **facets** for 4 or more variables: *subplots*

the following case show the plots **as a function of** islands:

```{r}
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species, shape = species)) +
  facet_wrap(~island)
```

While the following as a function of species:

```{r}
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = island, shape = island)) +
  facet_wrap(~species)
```

### 1.5.5. Excercises
